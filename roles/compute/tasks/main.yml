- name: Ensure epel is present
  ansible.builtin.dnf:
    name: epel-release

- name: Ensure the crb repository is enabled
  community.general.dnf_config_manager:
    name: crb
    state: enabled

- name: Ensure utilities are present
  ansible.builtin.dnf:
    name:
      - htop
      - nvtop
      - task-spooler
      - yt-dlp
      - vim
      - emacs

- name: Ensure VPN utilities are present
  ansible.builtin.dnf:
    name:
      - NetworkManager-openconnect
      - NetworkManager-openconnect-gnome
      - openconnect

- name: Ensure NVIDIA CUDA repo is present
  ansible.builtin.yum_repository:
    name: "{{ nvidia_cuda_repo_name }}"
    description: "{{ nvidia_cuda_repo_description }}"
    baseurl: "{{ nvidia_driver_rhel_cuda_repo_baseurl }}"
    gpgkey: "{{ nvidia_driver_rhel_cuda_repo_gpgkey }}"

- name: "Reset NVIDIA driver stream"
  ansible.builtin.dnf:
    name: 
      - nvidia-driver
      - "@nvidia-driver"
    state: absent
    autoremove: true
  when: nvidia_driver_reset_stream

- name: Ensure NVIDIA driver is present
  ansible.builtin.dnf:
    name: "{{ '@nvidia-driver:'+nvidia_driver_branch }}"